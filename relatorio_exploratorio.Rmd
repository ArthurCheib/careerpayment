---
title: "Salários EPPPGG - Análise Exploratória"
output: github_document
---

```{r include=FALSE}
library(tidyverse)
library(readxl)
library(data.table)
library(deflateBR)
library(scales)
library(ggthemes)
```

Para acessar do meu PC:
```{r}
setwd("C:/Users/arthu/OneDrive/Trabalho SEE/Datasets/pay_servidores")
load("eppggs_dataset.RData")
```

Para acessar do PC do Trabalho
```{r}
setwd()
load()
```

### Checagem simples das variáveis numéricas (distribuição):

```{r echo=FALSE}
summary(eppggs_df_final)

eppggs_dataset %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
  facet_wrap(~ key, scales = "free") +
  geom_histogram()
```

##  Verificar distribuição salarial da carreira por ano (tendência anual)
* a. Descontar cálculo anual da inflação usando 2013 como período-base
* b. Aumento percentual ano a ano da carreira (aumento real do salário)
* c. Verificar distribuição do aumento ao longos dos meses do ano (cada linha = ano; eixo x = mes)

```{r}
eppggs_dataset %>% 
  group_by(CSAP, DATA_SALARIO) %>% 
  summarize(TOTAL_CARREIRA = sum(REM_POS_DEDUCOES)) %>% 
  ggplot(aes(CSAP, TOTAL_CARREIRA, color = CSAP)) +
  geom_col() +
  coord_flip() +
  scale_y_continuous(labels = dollar_format())
```

Evolução da quantidade de EPPGGS na folha salarial entre 2013 e 2017
```{r}
eppggs_dataset %>% 
  group_by(ANO_SALARIO) %>% 
  summarize(TOTAL = n_distinct(CODIGO)) %>%
  ggplot(aes(ANO_SALARIO, TOTAL, fill = ANO_SALARIO)) +
  geom_col() +
  labs(title = "Evolução do total de Especialistas em Políticas Públicas \n e Gestão Governamental - entre 2013 e 2017",
       subtitle = "Estado de Minas Gerais") +
  theme_economist()
```


```{r}
eppggs_dataset %>% 
  group_by(ANO_SALARIO, CODIGO, CSAP, SEXO, CARGO_COMISSAO, ORGAO_ENTIDADE, CARGO, DESCUNID, INICIO_GRAD, CONCLUSAO_GRAD) %>%
  summarize_at(REM_BASICA_BRUTA, FERIAS, IRRF, CONT.PREVIDENCIRIA, REM_POS_DEDUCOES, sum(),
               MESES = n())

```


Para realizar a deflação dos valores reais:

library(deflateBR)
eppggs_df_final %>% mutate(reais_deflacionados = deflate(REM_POS_DEDUCOES, DATA_SALARIO, "01/2017", "ipca"))


## Quebrar análise por sexo:

* b. Verificar avanço número da proporção homens x mulheres (salário médio entre csaps (homens x mulheres))
* c. Verificar relação salarial entre os sexos (como fazer isso levando em conta a desprorporção)
* d. Qual foi o tempo médio gasto por um csapiano para assumir um cargo em até 02 anos ()

## Quebrar a análise por CSAP:
* Proporcionalmente, quanl CSAP tem hoje o melhor desempenho em:
* Permanência na carreira (prop. de quantos entraram e quantos saíram)
* Desempenho salarial global
* Rising stars (maior quantidade de cargos ou prop de csapianos com cargos)

## Análise do fluxo de EPPGG's dentro do Estado:
* Principal secretaria em que estão alocados
* Fluxo ao longo de 2013 - 2018 entre secretarias
* Fluxo entrada e saída de EPPGGS's na carreira


### Visualização geral das variáveis numéricas:
```{r}
summary(eppggs_df_final)

eppggs_df_final %>%
  keep(is.numeric) %>% 
  gather() %>% 
  ggplot(aes(value)) +
  facet_wrap(~ key, scales = "free") +
  geom_histogram()
```


# Problema do código com o caso dos csap que não foi possível encontrar o CSAP (galera do concurso)

        